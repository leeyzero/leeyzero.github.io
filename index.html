<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="U2Ny7FrEq1ignn4lLolgeVjRTn4pkY-QddMt4bC6OWA">
  <meta name="msvalidate.01" content="CBB1C3BC69BAC424DBCDE69CDC69A845">
  <meta name="baidu-site-verification" content="code-mfJglD7D92">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"leeyzero.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":true,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。">
<meta property="og:type" content="website">
<meta property="og:title" content="LeeYzero的博客">
<meta property="og:url" content="https://leeyzero.github.io/index.html">
<meta property="og:site_name" content="LeeYzero的博客">
<meta property="og:description" content="众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。">
<meta property="og:locale">
<meta property="article:author" content="LeeYzero">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://leeyzero.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh'
  };
</script>

  <title>LeeYzero的博客 - 自强不息，厚德载物</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">LeeYzero的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">自强不息，厚德载物</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-首页">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-分类">

    <a href="/categories" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-标签">

    <a href="/tags" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-归档">

    <a href="/archives" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-关于">

    <a href="/about" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://leeyzero.github.io/2025/03/30/ml-intro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="LeeYzero">
      <meta itemprop="description" content="众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeeYzero的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/03/30/ml-intro/" class="post-title-link" itemprop="url">机器学习之基本概念</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-03-30 16:37:52" itemprop="dateCreated datePublished" datetime="2025-03-30T16:37:52+08:00">2025-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-04-20 13:35:31" itemprop="dateModified" datetime="2025-04-20T13:35:31+08:00">2025-04-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">机器学习</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近两个月学完 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Andrew_Ng">Andrew Ng</a> 的 <a target="_blank" rel="noopener" href="https://www.coursera.org/learn/machine-learning/">机器学习</a> 课程，对机器学习有了一个整体的认识，感谢Andrew Ng及其团队，能够让机器学习这门专业学起来如此生动有趣。本文是对课程的学习笔记，主要目的是从宏观角度对机器学习整体框架和核心概念有基本认识并形成知识框架，以便在后续遇到实际问题时，能够进一步深入学习并解决实际问题。</p>
<h2 id="什么是机器学习"><a href="#什么是机器学习" class="headerlink" title="什么是机器学习"></a>什么是机器学习</h2><p><strong>机器学习</strong>（Machine Learning，简称ML）是人工智能（AI）的一个核心分支，是使计算机具有像人一样的学习能力的技术，其<strong>核心目标是让计算机系统通过从数据中自动学习规律和模式，从而完成任务或做出预测</strong>，而无需显式编程。</p>
<p>机器学习的核心是数据驱动和迭代优化：</p>
<ul>
<li><strong>数据驱动</strong>：机器学习依赖大量数据，通过分析数据中的统计规律、关联性或结构，形成模型（如分类规则、预测函数等）。</li>
<li><strong>迭代优化</strong>：系统通过不断调整模型参数（如神经网络的权重）来减少预测错误，逐步模型的准确性和性能。</li>
</ul>
<h2 id="机器学习的类型"><a href="#机器学习的类型" class="headerlink" title="机器学习的类型"></a>机器学习的类型</h2><p>根据所处理的数据种类的不同，机器学习可以分为<strong>有监督学习</strong>、<strong>无监督学习</strong>和<strong>强化学习</strong>。</p>
<h3 id="有监督学习"><a href="#有监督学习" class="headerlink" title="有监督学习"></a>有监督学习</h3><p><strong>有监督学习</strong>（Supervised Learning），是机器学习的一个分支，是指通过输入带有标签（正确答案）数据，模型学习输入到输出的映射。<strong>监督学习的核心是，从已知答案中学习规律</strong>。</p>
<p>如果把机器学习用一个函数表示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">y = f(x)</span><br></pre></td></tr></table></figure>

<p>x为输入，y为输出，f为模型，监督学习就是给定x和y，让机器学习f的过程。</p>
<p>监督学习也可以理解为，一位学生从老师那里获取知识，老师提供对错指示，告知最终答案的学习过程。学生对应于计算机，老师则对应于周围环境。根据在学习过程中所获得的经验、技能（即模型f），对没有学习过的问题也可以做出正确解答（推理），使计算机获得这种泛化能力。</p>
<p>监督学习在手写文字识别、声音处理、图像处理、垃圾邮件分类与拦截、基因诊断以及股票预测等方面都有广泛应用。</p>
<h3 id="无监督学习"><a href="#无监督学习" class="headerlink" title="无监督学习"></a>无监督学习</h3><p><strong>无监督学习</strong>（Unsupervised Learning）是机器学习的一个分支，是指通过无标签数据，模型自行发现隐藏结构（如聚类、降维）。<strong>核心在于从无标签数据中自动发现隐藏的结构、模式或规律，无需依赖人工标注的答案</strong>。与监督学习不同，无监督学习的目标是探索数据内在的分布特性，常用于数据探索、特征提取或预处理。</p>
<p>无监督学习也可以理解为，在没有老师的情况下，学生自学的过程（无师自通）。</p>
<p>无监督学习在客户分群市场分析、图像与信号处理、推荐系统、异常检测、自然语言处理、生成与合成等方面都有广泛应用。</p>
<h2 id="强化学习"><a href="#强化学习" class="headerlink" title="强化学习"></a>强化学习</h2><p><strong>强化学习</strong>（Reinforcement Learning）是机器学习的一个分支，<strong>其核心在于让智能体（Agent）通过与环境的交互学习最优策略，以最大化长期累积奖励</strong>。与监督学习（依赖标注数据）和无监督学习（探索数据分布）不同，强化学习通过“试错”机制在动态环境中自主决策，广泛应用于需要序列决策的复杂任务。</p>
<p>强化学习在游戏与竞技、机器人控制、自动驾驶、资源管理与优化、推荐系统（动态个性化推荐）以及医疗与健康都有广泛应用。</p>
<h2 id="机器学习的基本流程"><a href="#机器学习的基本流程" class="headerlink" title="机器学习的基本流程"></a>机器学习的基本流程</h2><h3 id="问题定义"><a href="#问题定义" class="headerlink" title="问题定义"></a>问题定义</h3><p>通过需求分析，明确输入、输出和约束条件，将业务问题抽象为机器学习问题。主要包括：</p>
<p>1、任务类型：明确机器学习任务，如回归、分类、聚类、强化学习等。<br>2、业务目标：将业务需求转化为可量化的机器学习目标，如预测用户点击率。<br>3、评估指标：选择合适的评估标准，如准备率、RMSE、AUC等。</p>
<h3 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h3><p>1、数据收集与清洗：消除噪声，保证数据质量。<br>2、特征工程：通过提取关键信息，提升模型对数据的表达能力。<br>3、数据增强：扩充数据多样性，防止过拟合。</p>
<h3 id="模型选择"><a href="#模型选择" class="headerlink" title="模型选择"></a>模型选择</h3><p>1、算法匹配问题：不同算法解决不同任务。</p>
<ul>
<li>回归任务：线性回归、梯度提升树（GBDT）、LSTM（时间序列）。</li>
<li>分类任务：逻辑回归、随机森林、SVM、神经网络。</li>
<li>聚类任务：K-Means、DBSCAN、层次聚类。</li>
</ul>
<p>2、超参数调优：平衡模型复杂度与泛化能力。</p>
<ul>
<li>网格搜索（Grid Search）：遍历预设参数组合，选择最优解。</li>
<li>随机搜索（Random Search）：高效探索超参数空间。</li>
<li>贝叶斯优化：基于概率模型指导参数搜索方向（如Hyperopt库）。</li>
</ul>
<h3 id="模型训练"><a href="#模型训练" class="headerlink" title="模型训练"></a>模型训练</h3><p>模型训练方法多种多样，主要根据数据使用方式、优化策略和学习模式进行分类。</p>
<p>1、基于梯度下降的优化方法：通过调整模型参数以最小化损失函数，梯度下降又包括：</p>
<ul>
<li>批量梯度下降（Batch Gradient Descent）：每次迭代使用全部训练数据计算梯度，更新参数。</li>
<li>随机梯度下降（Stochastic Gradient Descent, SGD）：每次迭代随机选择一个样本计算梯度，更新参数。</li>
<li>小批量梯度下降（Mini-batch SGD）：折中方案，每次使用一小批样本计算梯度。</li>
</ul>
<p>2、正则化与防过拟合方法：通过约束模型复杂度提升泛化能力</p>
<ul>
<li>早停法（Early Stopping）：在验证集性能不再提升时提前终止训练。</li>
<li>Dropout：训练中随机丢弃部分神经元，增强鲁棒性。</li>
</ul>
<p>3、数据驱动的增强方法：通过数据变换提升模型鲁棒性</p>
<ul>
<li>数据增强（Data Augmentation）：对输入数据进行变换（如旋转、裁剪）以扩展数据集。</li>
<li>对抗训练（Adversarial Training）：生成对抗样本并加入训练，提升模型抗干扰能力。</li>
</ul>
<p>4、迁移与自适应方法</p>
<ul>
<li>迁移学习（Transfer Learning）：复用预训练模型参数，微调（Fine-tuning）新任务。</li>
<li>领域自适应（Domain Adaptation）：调整源域和目标域分布差异。</li>
</ul>
<p>5、集成方法：组合多个模型提升整体性能</p>
<ul>
<li>Bagging（Bootstrap Aggregating）：通过自助采样训练多个模型并投票。</li>
<li>Boosting：序列化训练模型，后续模型修正前序错误。</li>
</ul>
<p>6、强化学习方法：通过环境交互优化策略</p>
<ul>
<li>Q-learning：基于价值迭代更新动作策略。</li>
<li>策略梯度（Policy Gradient）：直接优化策略函数参数。</li>
</ul>
<p>7、半监督与自监督方法：利用无标注数据辅助训练：</p>
<ul>
<li>自训练（Self-training）：用模型预测结果作为伪标签迭代训练。</li>
<li>对比学习（Contrastive Learning）：通过相似性对比学习数据表示。</li>
</ul>
<p>8、分布式训练方法：加速大规模数据训练：</p>
<ul>
<li>数据并行（Data Parallelism）：拆分数据到多个设备并行计算梯度。</li>
<li>模型并行（Model Parallelism）：拆分模型参数到不同设备。</li>
</ul>
<h3 id="模型评估"><a href="#模型评估" class="headerlink" title="模型评估"></a>模型评估</h3><p>根据任务类型选择指标，量化模型性能。</p>
<p>1、分类任务</p>
<ul>
<li>准确率（Accuracy）：正确预测样本数占总样本数的比例。</li>
<li>精确率（Precision）与召回率（Recall）：精确率是指预测为正的样本中实际为正的比例；召回率是指实际为正的样本中被正确预测的比例。</li>
<li>F1-Score：精确率和召回率的调和平均，综合衡量模型性能。</li>
<li>ROC 曲线与 AUC：ROC 曲线展示不同阈值下的 TPR（真正例率）与 FPR（假正例率），AUC 值越接近 1 模型越好。</li>
</ul>
<p>2、回归任务</p>
<ul>
<li>均方误差（MSE）：预测值与真实值差的平方均值，对异常值敏感。</li>
<li>平均绝对误差（MAE）：预测值与真实值差的绝对值均值，更鲁棒。</li>
<li>R²（决定系数）：模型解释数据方差的比例，越接近 1 越好。</li>
</ul>
<p>3、聚类任务</p>
<ul>
<li>轮廓系数（Silhouette Coefficient）：衡量样本聚类紧密度和分离度，范围 [-1, 1]，越大越好。</li>
</ul>
<h3 id="模型部署与应用"><a href="#模型部署与应用" class="headerlink" title="模型部署与应用"></a>模型部署与应用</h3><p>该过程更多是对模型的工程化。是指将模型集成到实际系统（如推荐系统），并通过监控系统，持续检测数据漂移（如特征分布变化）、模型性能衰减等，再根据数据和业务的变化对模型进行迭代。</p>
<h2 id="机器学习的应用"><a href="#机器学习的应用" class="headerlink" title="机器学习的应用"></a>机器学习的应用</h2><p>机器学习作为人工智能的核心技术，已广泛应用于多个领域，深刻改变了传统行业的运作模式，主要应用场景包括但不限于：</p>
<p>1、计算机视觉（CV）</p>
<ul>
<li>医疗影像分析：辅助医生检测肿瘤（如乳腺癌筛查）、分析X光片和MRI图像。</li>
<li>自动驾驶：实时识别行人、车辆和交通标志，支撑特斯拉、Waymo等系统。</li>
<li>安防监控：人脸识别用于公共安全（如机场安检）、异常行为检测（如商场防盗）。</li>
</ul>
<p>2、自然语言处理（NLP）</p>
<ul>
<li>智能客服：ChatGPT、客服机器人（如银行服务）处理用户查询。</li>
<li>情感分析：舆情监控（如品牌声誉管理）、社交媒体情绪追踪。</li>
<li>机器翻译：谷歌翻译、DeepL支持多语言实时转换。</li>
</ul>
<p>3、推荐系统</p>
<ul>
<li>电商平台：亚马逊、淘宝的个性化商品推荐，提升用户购买率。</li>
<li>内容平台：Netflix、YouTube的影视推荐，抖音的短视频推送。</li>
</ul>
<p>4、金融</p>
<ul>
<li>欺诈检测：信用卡异常交易识别（如PayPal的风险模型）。</li>
<li>量化交易：高频交易算法预测股价波动（如对冲基金RenTec）。</li>
<li>信用评分：蚂蚁金服的芝麻信用评估用户还款能力。</li>
</ul>
<p>5、工业与物联网（IoT）</p>
<ul>
<li>预测性维护：工厂设备故障预警（如西门子工业AI）。</li>
<li>供应链优化：需求预测（如沃尔玛库存管理）、物流路径规划。</li>
</ul>
<p>6、医疗健康</p>
<ul>
<li>药物研发：DeepMind的AlphaFold预测蛋白质结构，加速新药开发。</li>
<li>个性化治疗：基于患者数据的定制化诊疗方案（如IBM Watson Oncology）。</li>
</ul>
<p>7、教育</p>
<ul>
<li>自适应学习：Knewton平台根据学生表现调整课程难度。</li>
<li>智能阅卷：自动批改作文（如ETS的e-rater系统）。</li>
</ul>
<h2 id="机器学习、神经网络、深度学习、Transformer以及大语言模型之间的关系"><a href="#机器学习、神经网络、深度学习、Transformer以及大语言模型之间的关系" class="headerlink" title="机器学习、神经网络、深度学习、Transformer以及大语言模型之间的关系"></a>机器学习、神经网络、深度学习、Transformer以及大语言模型之间的关系</h2><p>ChartGPT出现后，大语言模型、Transformer等名词频繁出现在各类文章中。那机器学习、神经网络、深度学习、Transformer以及大语言模型之间是什么关系呢？</p>
<p><strong>机器学习（Machine Learning）</strong>是人工智能的一个分支，让计算机通过数据自动学习规律，而不需要显式编程，完成预测或决策任务。</p>
<p><strong>神经网络（Neural Networks）</strong>是受生物神经元启发设计的数学模型，由相互连接的“神经元”组成，能通过调整权重从数据中学习，它是机器学习的一种具体实现方式。</p>
<p><strong>深度学习（Deep Learning）</strong>属于神经网络的分支，强调“深度”结构，通过增加隐藏层数量（“深度”）提升模型对复杂数据（如图像、文本）的表征能力。</p>
<p><strong>Transformer</strong>是深度学习中的一种新型架构，是2017年 Google 在论文《Attention Is All You Need》中提出，旨在解决 RNN 的序列处理效率低和长程依赖问题。</p>
<p><strong>大语言模型（Large Language Models, LLMs）</strong>是基于 Transformer 架构的超大规模预训练模型，是Transformer架构的典型应用。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  
  
  



      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://leeyzero.github.io/2024/12/29/working-effectively-with-legacy-code/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="LeeYzero">
      <meta itemprop="description" content="众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeeYzero的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/29/working-effectively-with-legacy-code/" class="post-title-link" itemprop="url">修改代码的艺术</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-12-29 10:15:17 / Modified: 12:52:10" itemprop="dateCreated datePublished" datetime="2024-12-29T10:15:17+08:00">2024-12-29</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E5%8C%A0%E8%89%BA/" itemprop="url" rel="index"><span itemprop="name">编程匠艺</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="/images/working-effectively-with-legacy-code/cover.jpeg" alt="cover"></p>
<hr>
<p>这篇文章基于最近在团队内做了一次分享，并做了一些简单修改，仅供各位网友参考，观点不一定成熟，但都是结合实际问题的一些反思与总结，欢迎讨论。</p>
<p>在软件的整个生命周期中，80%以上的时间是在维护软件，这也是开发者每天面临的最主要的工作。如果对代码的变更没有“章法”，随着时间流逝，软件就会不可避免地渐渐变得复杂、难以理解，最终拖慢产品迭代效率，甚至频繁引入线上故障，导致业务损失。</p>
<p>对于这个主题，<a target="_blank" rel="noopener" href="https://dl.ebooksworld.ir/motoman/Working.Effectively.with.Legacy.Code..www.EBooksWorld.ir.pdf">Working Effectively with Legacy Code</a> 和 <a target="_blank" rel="noopener" href="https://silab.fon.bg.ac.rs/wp-content/uploads/2016/10/Refactoring-Improving-the-Design-of-Existing-Code-Addison-Wesley-Professional-1999.pdf">Refactoring Improving the Design of Existing Code</a> 给出了很多具体的做法，本文不会一一介绍。本文主要分为两部分：</p>
<ul>
<li>第一部分主要介绍软件的变更机制以及应对变更的策略，并着重介绍安全变更的重要保障——单元测试；</li>
<li>第二部以通过一个案例解释如何进行安全重构；</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/12/29/working-effectively-with-legacy-code/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  
  
  



      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://leeyzero.github.io/2024/11/03/modular-design-criteria/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="LeeYzero">
      <meta itemprop="description" content="众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeeYzero的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/11/03/modular-design-criteria/" class="post-title-link" itemprop="url">关于将系统分解为模块所采用的标准</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-11-03 08:05:57" itemprop="dateCreated datePublished" datetime="2024-11-03T08:05:57+08:00">2024-11-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-17 18:48:05" itemprop="dateModified" datetime="2024-11-17T18:48:05+08:00">2024-11-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E5%8C%A0%E8%89%BA/" itemprop="url" rel="index"><span itemprop="name">编程匠艺</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文介绍计算机科学先驱<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/David_Parnas">David. L. Parnas</a>在1972发表论文 <a target="_blank" rel="noopener" href="https://dl.acm.org/doi/10.1145/361598.361623">On the Criteria To Be Used in Decomposing Systems into Modules</a>。这篇论文首次提出了信息隐藏(information hiding）的思想，这一思想为面向对象程序设计的发展奠定了基础。在这篇论文中，Parnas 通过一个简单的例子论证和说明，如何将一个复杂系统分解为模块的标准。</p>
<p>这是一篇真正的经典论文！50多年过去了，虽然软件开发工具（如编译器、编程语言、IDE、中间件等）得到了长远发展，但软件开发的思想却并没有超越这篇论文。如果将论文中的模块换成服务，这一标准仍然适用于当前流行的微服务架构。</p>
<p>本文作者经历过几个大型软件的设计与开发经验，深刻理解模块化编程在复杂系统开发中的重要性，读完这篇论文后，有很多共鸣。本文是对这篇论文解读并谈谈自己的一些理解。</p>
<h2 id="核心思想"><a href="#核心思想" class="headerlink" title="核心思想"></a>核心思想</h2><p>摘要中的第一句话便给出了论文的目标：</p>
<blockquote>
<p>This paper discusses modularization as a mechanism for improving the flexibility and comprehensibility of a system while allowing the shortening of its development time.</p>
<p><em>本文讨论了模块化作为一种提高系统灵活性和可理解性的同时缩短开发时间的一种机制。</em></p>
</blockquote>
<p><strong>灵活性</strong>和<strong>可理解性</strong>在整个软件生命周期中，都是在解决同一个问题——<strong>开发效率</strong>，但侧重的阶段不一样。灵活性更强调在软件开发阶段，提高开发效率；可理解性则更多体现在软件维护阶段将具有更低成本。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/11/03/modular-design-criteria/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  
  
  



      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://leeyzero.github.io/2024/10/06/software-design-philosophy/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="LeeYzero">
      <meta itemprop="description" content="众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeeYzero的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/06/software-design-philosophy/" class="post-title-link" itemprop="url">软件设计哲学</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-10-06 18:34:33" itemprop="dateCreated datePublished" datetime="2024-10-06T18:34:33+08:00">2024-10-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-20 23:38:50" itemprop="dateModified" datetime="2024-10-20T23:38:50+08:00">2024-10-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E5%8C%A0%E8%89%BA/" itemprop="url" rel="index"><span itemprop="name">编程匠艺</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="/images/software-design-philosophy/cover.jpg" alt="cover"></p>
<hr>
<p>最近本来想写一篇如何应对复杂系统的文章，偶然读到<a target="_blank" rel="noopener" href="https://web.stanford.edu/~ouster/cgi-bin/home.php">John Ousterhout</a>的<a target="_blank" rel="noopener" href="https://milkov.tech/assets/psd.pdf">软件设计哲学</a>，读完后，发现我没有必要再写了。这篇文章对原文做一个概要性总结并谈谈自己的理解和思考。</p>
<p>对于一个软件系统，需求可以粗略的分为两类：</p>
<ul>
<li>功能性需求</li>
<li>非功能性需求</li>
</ul>
<p>功能性需求是面向用户的，非功能性需求是面向系统的，但非功能性需求最终是服务于功能性需求。我们通常会用非功能性需求去评估一个系统的质量，比如扩展性、维护性、安全性等。</p>
<p>那什么是软件设计呢？软件设计就是折衷（Trade Offs）。实际情况下，资源是受限的，需求面临着各种因素的制约，<strong>软件设计就是在有限资源条件下对影响因素的一种权衡</strong>。而这本书从另一个角度阐明了：<strong>软件设计即管理复杂性</strong>。在我看来，它更偏向于对非功能性需求的一种定义。</p>
<p>围绕着复杂性这个主题，这本书回答了以下三个问题：</p>
<ul>
<li>什么是复杂性？</li>
<li>软件系统为什么会变得复杂？</li>
<li>如何降低软件系统的复杂性？</li>
</ul>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/10/06/software-design-philosophy/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  
  
  



      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://leeyzero.github.io/2024/09/13/time-clock-ordering-events-in-distributed-system/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="LeeYzero">
      <meta itemprop="description" content="众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeeYzero的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/13/time-clock-ordering-events-in-distributed-system/" class="post-title-link" itemprop="url">分布式系统中的时间、时钟以及事件顺序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-09-13 13:10:54" itemprop="dateCreated datePublished" datetime="2024-09-13T13:10:54+08:00">2024-09-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-20 23:41:17" itemprop="dateModified" datetime="2024-10-20T23:41:17+08:00">2024-10-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">分布式系统</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://lamport.azurewebsites.net/">Leslie Lamport</a> 在1978年发表了一篇论文<a target="_blank" rel="noopener" href="https://lamport.azurewebsites.net/pubs/time-clocks.pdf">Time, Clocks, and the Ordering of Events in a Distributed System</a>，对分布式系统领域产生的深远影响，这篇论文也成为分布系统领域引用最高的文献之一。</p>
<p>论文中定义了分布式系统中事件的”happen before”关系，并引入了逻辑时钟解决分布式系统中事件同步的问题。但由于系统之外的信息传递并不受系统内部逻辑时钟的约束，所以会出现因果不一致的问题。于是论文中又提出物理时钟，只要能保证各进程中物理时钟同步在一个合理误差范围内，就能保证系统的全局排序。</p>
<p>读完后，除了对分布式系统中事件同步有了新的认识外，也对系统设计有了一些新的思考。这篇文章主要对论文做一些解读并谈谈自己的解理。</p>
<h2 id="相对论的启示"><a href="#相对论的启示" class="headerlink" title="相对论的启示"></a>相对论的启示</h2><p>据Leslie Lamport本人<a target="_blank" rel="noopener" href="https://www.microsoft.com/en-us/research/publication/time-clocks-ordering-events-distributed-system/">回忆</a>，当他看到Paul Johnson和Bob Thomas的论文<a target="_blank" rel="noopener" href="http://www.rfc-archive.org/getrfc.php?rfc=677">The Maintenance of Duplicate Databases</a>中使用时间戳来提供分布式系统中的全局一致性时，他立即看出了算法中存在的问题。他之所以能够一下看出其本质，原因在于他对相对论有深刻的认识：</p>
<blockquote>
<p>Special relativity teaches us that there is no invariant total ordering of events in space-time; different observers can disagree about which of two events happened first. There is only a partial order in which an event e1 precedes an event e2 iff e1 can causally affect e2.</p>
</blockquote>
<p><strong>狭义相对论告诉我们，时空中事件不存在绝对的全局顺序；不同的观察者可能对两件事件中哪件先发生持有不同的看法。事件在时空中只存在部分有序，只有当 e1 对 e2 产生因果影响时，事件 e1 才先于事件 e2。</strong></p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/09/13/time-clock-ordering-events-in-distributed-system/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  
  
  



      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://leeyzero.github.io/2024/05/26/regex-tutorial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="LeeYzero">
      <meta itemprop="description" content="众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeeYzero的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/05/26/regex-tutorial/" class="post-title-link" itemprop="url">正则表达式简明教程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-26 23:16:20" itemprop="dateCreated datePublished" datetime="2024-05-26T23:16:20+08:00">2024-05-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-20 23:38:50" itemprop="dateModified" datetime="2024-10-20T23:38:50+08:00">2024-10-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E5%8C%A0%E8%89%BA/" itemprop="url" rel="index"><span itemprop="name">编程匠艺</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>有些人在碰到问题时，就想：“我知道，我可以使用正则表达式。”现在，他们就有了两个问题。<br>– by Jamie “jwz” Zawinski， 1997年 8月</p>
</blockquote>
<h2 id="什么是正则表达式"><a href="#什么是正则表达式" class="headerlink" title="什么是正则表达式"></a>什么是正则表达式</h2><p>正则表达式（Regular Expression），通常缩写为regex或regexp，是一种在文本中进行搜索和替换的模式描述语言。它使用单个字符串来描述、匹配一系列符合某个句法规则的字符串。正则表达式是由<strong>普通字符</strong>（例如：字母和数字）以及<strong>元字符</strong>组成的。</p>
<p>这篇<a target="_blank" rel="noopener" href="https://www.tiki-toki.com/timeline/entry/264740/The-Bloody-History-of-Regex">slide</a> 描述正则表达式的发展历史。<br><a target="_blank" rel="noopener" href="https://www.regular-expressions.info/">regular-expressions</a>是学习正则表达式的一个非常好的网站。</p>
<h2 id="初识正则表达式"><a href="#初识正则表达式" class="headerlink" title="初识正则表达式"></a>初识正则表达式</h2><p>我们在日常中可能已经使用过正则表达式，比如我们在电脑中查找所有doc文档时，会使用<code>*.doc</code>搜索，这个就是正则表达式。其中<code>*</code>为元字符，表示可以匹配任意字符。<code>.doc</code>是普通字符，表示后续为.doc的文档。</p>
<p>当然这是一个比较简单的例子，正则表达式的功能非常强大，它提供了很多的特性，非常灵活。</p>
<p>在自己的日常开发过程中，有两种场景使用正常表达式比较多：</p>
<ul>
<li>使用Linux命令，如<code>grep</code>、<code>sed</code>、<code>awk</code>中的提供的正则表达式能力查询日志。</li>
<li>使用各语言，如<code>Python</code>、<code>PHP</code>、<code>Go</code>中提供的正则表达式库在大文本中查找目标字符串。</li>
</ul>
<p>熟练掌握正则表达式，在处理字符匹配的问题上可以事半功倍。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/05/26/regex-tutorial/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  
  
  



      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://leeyzero.github.io/2024/04/27/vscode-go-debugging/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="LeeYzero">
      <meta itemprop="description" content="众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeeYzero的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/27/vscode-go-debugging/" class="post-title-link" itemprop="url">vscode-go调试工具</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-04-27 16:44:07" itemprop="dateCreated datePublished" datetime="2024-04-27T16:44:07+08:00">2024-04-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-20 23:38:50" itemprop="dateModified" datetime="2024-10-20T23:38:50+08:00">2024-10-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">开发工具</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>工欲善其事，必先利其器。作为一个曾经的资深vim党，在使用过<a target="_blank" rel="noopener" href="https://github.com/cdr/code-server">CodeServer</a>后，基本上不再使用vim了。CodeServer作为vscode的云端IDE，再也不用搭建本地开发环境了。之前介绍了 <a href="/2022/05/08/deploy-codeserver-on-centos/" title="CentOS搭建CodeServer环境">CentOS搭建CodeServer环境</a>，只需要几步，就可以搭建自己的云端IDE，非常方便。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/golang/vscode-go">vscode-go</a>是vscode中针对Go语言的扩展，提供了丰富的<a target="_blank" rel="noopener" href="https://github.com/golang/vscode-go/wiki/features">特性</a>，包括：</p>
<ul>
<li>智能感知（IntelliSense）</li>
<li>代码导航（Code navigation）</li>
<li>代码编辑（Code editing）</li>
<li>诊断（Diagnostics）</li>
<li>增强的测试和调试支持（Enhanced support for testing and debugging）</li>
</ul>
<p>vscode提供了语言无关的调试适配协议 <a target="_blank" rel="noopener" href="https://microsoft.github.io/debug-adapter-protocol/">Debug Adapter Protocol</a>，使用各语言可以基于vscode的扩展实现各自的调试器。对于Go语言，其实现为<a target="_blank" rel="noopener" href="https://github.com/go-delve/delve/tree/master/service/dap">dlv-dap</a>。</p>
<p>本文主要介绍在vscode如何使用vscode-go提供的debugging能力对go代码进行调试。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/04/27/vscode-go-debugging/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  
  
  



      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://leeyzero.github.io/2024/04/17/go-json-unmarshal-loss-precision-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="LeeYzero">
      <meta itemprop="description" content="众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeeYzero的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/17/go-json-unmarshal-loss-precision-2/" class="post-title-link" itemprop="url">Go json.Unmarshal 精度丢失问题分析（2/2）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-04-17 23:37:26" itemprop="dateCreated datePublished" datetime="2024-04-17T23:37:26+08:00">2024-04-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-20 23:38:50" itemprop="dateModified" datetime="2024-10-20T23:38:50+08:00">2024-10-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="缘起"><a href="#缘起" class="headerlink" title="缘起"></a>缘起</h2><p>最近出现一例json.Unmarshal导致的精度丢失引发的线上问题，虽然这个问题在被及时发现，未对业务造成损失，但细挖这个问题的原因仍然比较有意思。这篇文章会从技术层面深入分析json.Unmarshal精度丢失的原因以及处理建议，以避免后续开发过程中再次踩坑。</p>
<p>在 <a href="/2024/04/16/go-json-unmarshal-loss-precision-1/" title="Part1">Part1</a> 中，我们着重说明了json.Unmarshal处理大整数可能出现精度丢失的问题，但遗留了一个问题，即大整数置换成浮点数时，为什么会造成精度丢失，在这篇文章中我会详细解释原因。</p>
<p>Go语言对浮点数的处理遵循<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-745</a>标准，该标准规定了浮点数在计算机中的二进制表示以及舍入方式，下面先补充一些基础知识，然后再结合 <a href="/2024/04/16/go-json-unmarshal-loss-precision-1/" title="Part1">Part1</a> 中的case，分析精度丢失的原因。</p>
<h2 id="十进制与二进制"><a href="#十进制与二进制" class="headerlink" title="十进制与二进制"></a>十进制与二进制</h2><p>十进制用0-9表示，逢十进一，同时二进制用0和1表示，逢二进一。而每个位可以使用位的值乘以位的权重表示，直接看例子：</p>
<p>十进制12.34可以表示为：<br>12.34 = 1×10<sup>1</sup> + 2×10<sup>0</sup> + 3×10<sup>−1</sup> + 4×10<sup>−2</sup> = 12.34</p>
<p>同理二进制101.11也可以表示为：</p>
<p>101.11 = 1×2<sup>2</sup> + 0×2<sup>1</sup> + 1×2<sup>0</sup> + 1×2<sup>−1</sup> + 1×2<sup>−2</sup> = 4 + 0 + 1 + 1/2 + 1/4 = 5.75</p>
<p><strong>十进制小数点向左移动1位相当于将该数除以10，向右移动1位相当于将该数乘以10。</strong><br>例如：123/10 = 12.3，12.3×10 = 123。</p>
<p>同理，<strong>二进制小数点向左移动1位相当于将该数除以2，向右移动1位相当于将该数乘以2。</strong></p>
<p>例如：11/2 = 1.1，1.1x2 = 11</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/04/17/go-json-unmarshal-loss-precision-2/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  
  
  



      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://leeyzero.github.io/2024/04/16/go-json-unmarshal-loss-precision-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="LeeYzero">
      <meta itemprop="description" content="众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeeYzero的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/16/go-json-unmarshal-loss-precision-1/" class="post-title-link" itemprop="url">Go json.Unmarshal 精度丢失问题分析（1/2）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-04-16 23:37:26" itemprop="dateCreated datePublished" datetime="2024-04-16T23:37:26+08:00">2024-04-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-20 23:38:50" itemprop="dateModified" datetime="2024-10-20T23:38:50+08:00">2024-10-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="缘起"><a href="#缘起" class="headerlink" title="缘起"></a>缘起</h2><p>最近出现一例json.Unmarshal导致的精度丢失引发的线上问题，虽然这个问题在被及时发现，未对业务造成损失，但细挖这个问题的原因仍然比较有意思。这篇文章会从技术层面深入分析json.Unmarshal精度丢失的原因以及处理建议，以避免后续开发过程中再次踩坑。</p>
<p>在分析这个问题的过程中，发现涉及Go对浮点数数值的处理，又涉及IEEE-745标准中的一些细节，放在一篇文章中会增大文章的阅读难度，故拆分成了两个部分：</p>
<ul>
<li><a href="/2024/04/16/go-json-unmarshal-loss-precision-1/" title="Part1">Part1</a>： 引出json.Unmarshal处理大整数可能出现精度丢失的问题，并浅层次分析原因以及解决办法。</li>
<li><a href="/2024/04/17/go-json-unmarshal-loss-precision-2/" title="Part2">Part2</a>： 先补充IEEE-745的背景知识，然后解释为什么json.Unmarshal处理大整数可能会出现精度丢失。

</li>
</ul>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>这个问题的现象是，原始json string是一个字典，其中包含了一个大整数，在业务场景中，需要向该字典中追加一些字段，然后再序列化后进行存储。为了使用上的方便，代码中使用map[string]any去接收json.Unmarshal的结果，然后再使用json.Marshal序列化，结果发现序列化后的大整数跟原始大整数不致。</p>
<p>下面代码片段做了一些简化，同时忽略错误处理细节：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">str := <span class="string">`&#123;&quot;id&quot;:16505201442738640729&#125;`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[<span class="keyword">string</span>]any</span><br><span class="line">json.Unmarshal([]<span class="keyword">byte</span>(str), &amp;m)</span><br><span class="line"></span><br><span class="line">data, _ := json.Marshal(&amp;m)</span><br><span class="line">fmt.Println(<span class="keyword">string</span>(data))</span><br></pre></td></tr></table></figure>

<p>上面代码片段输出：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;id&quot;:16505201442738640000&#125;</span><br></pre></td></tr></table></figure>

<p>原始json string中，id的值是16505201442738640729，经过json.Unmarshal和json.Marshal后，id的值变成了16505201442738640000，看起来出现了精度有丢失。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/04/16/go-json-unmarshal-loss-precision-1/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  
  
  



      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh">
    <link itemprop="mainEntityOfPage" href="https://leeyzero.github.io/2024/04/14/deploy-php-on-centos/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="LeeYzero">
      <meta itemprop="description" content="众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LeeYzero的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/04/14/deploy-php-on-centos/" class="post-title-link" itemprop="url">CentOS搭建Nginx+PHP环境</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-04-14 15:18:04" itemprop="dateCreated datePublished" datetime="2024-04-14T15:18:04+08:00">2024-04-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-10-20 23:38:50" itemprop="dateModified" datetime="2024-10-20T23:38:50+08:00">2024-10-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">开发工具</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>虽然PHP做业务后端逐步在被Go等语言替代，但使用PHP做简单业务封装和数据组装时，开发效率依然是比较高效的。使用Nginx运行PHP的常用方法是FastCGI模块。PHP-FPM (FastCGI进程管理器）极大地提高了你的Nginx+PHP环境的性能，所以这对高负载的网站很有用。本教程介绍在CentOS8上安装Nginx并配置PHP-FPM的步骤，以便后续参考。</p>
<h2 id="依赖环境"><a href="#依赖环境" class="headerlink" title="依赖环境"></a>依赖环境</h2><ul>
<li>CentOS8</li>
<li>拥有sudo权限</li>
<li>更新dnf</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf update </span><br></pre></td></tr></table></figure>

<h2 id="Step1-安装Nginx"><a href="#Step1-安装Nginx" class="headerlink" title="Step1 安装Nginx"></a>Step1 安装Nginx</h2><p>Nginx在仓库中已经存在，可以使用dnf工具直接安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf install nginx</span><br></pre></td></tr></table></figure>

<p>启动Nginx服务，同时让Nginx服务在系统启动时自动启动。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable nginx</span><br><span class="line">sudo systemctl start nginx</span><br></pre></td></tr></table></figure>

<p>检查nginx是否已启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status nginx</span><br></pre></td></tr></table></figure>

<p>如果您的系统上启用了防火墙，请确保打开HTTP端口以供远程系统访问。HTTP为80端口，HTTPS，为443端口。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --zone=public --permanent --add-service=http</span><br><span class="line">sudo firewall-cmd --zone=public --permanent --add-service=https</span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>在浏览器使用ip访问主机器，看是否能访问到nginx的默认页面了呢？</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2024/04/14/deploy-php-on-centos/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>

  
  
  




  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="LeeYzero"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">LeeYzero</p>
  <div class="site-description" itemprop="description">众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">67</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">107</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/leeyzero" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;leeyzero" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:leeyzero@163.com" title="E-Mail → mailto:leeyzero@163.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      link
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://lamport.azurewebsites.net/pubs/pubs.html" title="http:&#x2F;&#x2F;lamport.azurewebsites.net&#x2F;pubs&#x2F;pubs.html" rel="noopener" target="_blank">Leslie Lamport</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://martinfowler.com/" title="https:&#x2F;&#x2F;martinfowler.com&#x2F;" rel="noopener" target="_blank">Martin Fowler</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.codinghorror.com/" title="https:&#x2F;&#x2F;blog.codinghorror.com&#x2F;" rel="noopener" target="_blank">Coding Horror</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.joelonsoftware.com/" title="https:&#x2F;&#x2F;www.joelonsoftware.com&#x2F;" rel="noopener" target="_blank">Joel on Software</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://steve-yegge.blogspot.com/" title="http:&#x2F;&#x2F;steve-yegge.blogspot.com&#x2F;" rel="noopener" target="_blank">Steve Yegge</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://highscalability.com/" title="http:&#x2F;&#x2F;highscalability.com&#x2F;" rel="noopener" target="_blank">High Scalability</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://coolshell.cn/" title="https:&#x2F;&#x2F;coolshell.cn&#x2F;" rel="noopener" target="_blank">coolshell</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.ruanyifeng.com/blog/" title="http:&#x2F;&#x2F;www.ruanyifeng.com&#x2F;blog&#x2F;" rel="noopener" target="_blank">阮一峰的网络日志</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LeeYzero</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>















  

  


</body>
</html>
